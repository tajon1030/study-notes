# 모던 자바 인 액션

## Part 6. 함수형 프로그래밍과 자바 진화의 미래
### chapter 18. 함수형 관점으로 생각하기
#### 18.1 시스템구현과 유지보수
많은 프로그래머가 유지보수중 코드 크래시 디버깅 문제를 많이 겪게 되는데, 이는 예상치 못한 변수값때문에 발생할 수 있다.  
함수형 프로그래밍이 제공하는 no side effect와 불변성이라는 개념이 이 문제를 해결하는데 도움을 준다.  

##### 18.1.1 공유된 가변 데이터
공유 가변 데이터 구조를 사용하면 프로그램 전체에서 데이터 갱신 사실을 추적하기가 어려워진다.  
자신을 포함하는 클래스의 상태 그리고 다른 객체의 상태를 바꾸지 않으며 return 문을 통해서만 자신의 결과를 반환하는 메서드를 순수메서드 혹은 부작용없는 메서드 라고 부른다.  
부작용의 예  
- 자료구조를 고치거나 필드에 값을 할당하는 생성자 이외의 초기화 동작  
- 예외발생
- 파일에 쓰기등의 I/O 동작을 수행  

불변 객체를 이용하여 부작용을 없앨수도 있다. 인스턴스화한 불변 객체의 상태는 결코 예상치못한 상태로 바뀌지않으므로,  
불변객체는 복사하지않고 공유할수있으며 객체의 상태를 바꿀수없어 스레드 안전성을 제공한다.  
부작용 없는 시스템 컴포넌트에서는 메서드가 서로 간섭하는 일이 없으므로 락을 사용하지않고도 멀티코어 병렬성을 사용할 수 있다.  

##### 18.1.2 선언형 프로그래밍
작업을 어떻게 수행할것인지에 집중하는 방식 = 고전 객체지향 프로그래밍에서 사용하는 방식 = 명령형 프로그래밍  
무엇을에 집중하는 프로그래밍방식 = 내부반복 구현방식(라이브러리가 질의 구현 결정) = 선언형 프로그래밍  

함수형 프로그래밍은 선언형 프로그래밍을 따르는 대표적 방식  
부작용 없는 계산을 지향한다.  
-> 좀더 쉽게 시스템을 구현하고 유지보수하는데 도움을 줌

#### 18.2 함수형 프로그래밍이란
함수를 이용하는 프로그래밍 -> 함수란?  
0개 이상의 인수를 가지며 한개 이상의 결과를 반환하지만 부작용이 없어야함  

##### 18.2.1 함수형 자바
객체의 모든 필드가 final이야하고 모든 참조필드는 불변객체를 직접 참조해야함  
함수나 메서드가 어떤 예외도 일으키지 않아야한다.(Optional<T>를 사용하거나 다른 컴포넌트에 영향을 미치지 않도록 지역적으로만 예외를 사용할 수 있음)  

##### 18.2.2 참조 투명성
같은 인수로 함수를 호출했을 때 항상 같은 결과를 반환  
비싸거나 오랜 시간이 걸리는 연산을 memorization 또는 캐싱을 통해 다시 계산하지않고 저장하는 최적화기능도 제공함  

#### 18.3 재귀와 반복
순수 함수형 프로그래밍 언어에서는 while, for 같은 반복문을 포함하지않음  
-> 루프내부에서 프로그램의 다른 부분과 공유되는 객체의 상태를 변화시킬수있기때문  
이를 막기위해 재귀를 이용하여 반복대신 사용할 수 있다.  
자바에서는 재귀를 스트림을 사용해서 구현할수있다.  
그러나 재귀는 일반적으로 입력값에 비례해 메모리 사용량이 증가한다는 단점이 있다.  
함수형언어에서는 꼬리호출최적화(중간결과를 각각의 스택프레임으로 저장하지않고 컴파일러가 하나의 스택프레임을 재활용)를 통해 해결함  

#### 18.4 마치며
- 공유된 가변 자료구조를 줄이는 것은 장기적으로 프로그램을 유지보수하고 디버깅하는데 도움이 된다.
- 함수형 프로그래밍은 부작용이 없는 메서드와 선언형 프로그래밍 방식을 지향한다.
- 함수형 메서드는 입력인수와 출력결과만을 갖는다.
- 같은 인수값으로 함수를 호출했을 때 항상 같은 값을 반환하면 참조 투명성을 갖는 함수다. while 루프 같은 반복문은 재귀로 대체할 수 있다.
- 자바에서는 고전 방식의 재귀보다는 꼬리 재귀를 사용해야 추가적인 컴파일러 최적화를 기대할 수 있다.
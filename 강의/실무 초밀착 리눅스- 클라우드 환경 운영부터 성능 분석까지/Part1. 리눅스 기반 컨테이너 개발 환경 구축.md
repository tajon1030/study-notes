# 실무 초밀착 리눅스: 클라우드 환경 운영부터 성능분석까지_Part1. 리눅스 기반 컨테이너 개발 환경 구축  
## CH01. 컨테이너 기반 가상화 소개  
### 컨테이너의 장점  
- 민첩성 : 개발자가 어플리케이션을 빌드하고 더 빠른 배포  
- 이식성: OS나 클라우드 종류와 관계없이 이식가능  
- 신속한 확장성 : 신속한 스케일링 지원  

### VM과 컨테이너 비교  
하이퍼바이저는 한대의 서버에 독립된 여러 머신환경을 구성이며,  
호스트컴퓨터에서 다수의 운영체제를 동시에 실행하기위한 논리적 플랫폼이다.  

#### VM  
VM은 저수준 하드웨어장치를 가상화(CPU,Disk,Network)  
다양한 운영체제를 실행  
물리머신대비 동일자원을 효율적으로 사용  
OS이미지를 반복적으로 포함해야하는 단점  

#### Container
컨테이너는 애플리케이션 구동에 필요한 모든 종속성을 포함한 소프트웨어 패키지를 운영체제 위에서 가상화  
- 컨테이너를 어느 환경에나 배포 가능  
- OS를 부팅하거나 라이브러리를 로드할 필요가 없음  
- 가상환경을 더 효율적이고 경량으로 생성 가능  
- 수초 이내의 빠른 시작 시간  
- 하나의 호스트에 더 많은 어플리케이션 실행 가능  
- OS 패치 업데이트 등 유지 관리와 관련된 오버헤드 감소  
- 컨테이너가 정의된 운영체제에 종속성 단점

### 다중운영체제 지원
Docker에 다중 운영체제 사용이 가능할까요? -> YES! 도커허브에 다양한 OS이미지 존재  
OS레벨 가상화 : 호스트 OS의 커널을 공유  

#### 리눅스, 리눅스 배포판, 리눅스 커널 차이  
리눅스배포판 -> 우분투,레드햇,CentOS, SUSE : 리눅스커널+컴포넌트  
리눅스커널 -> 하드웨어 자원을 관리하고 추상화하여 프로세스에게 할당하고 관리하는 역할을 수행  
컴포넌트 -> 윈도우시스템, 애플리케이션, 데스크톱환경, 서비스데몬, 패키지매니저  

다시돌아와서 Ubuntu호스트 Docker에 Amazon리눅스 배포판을 실행 가능한지를 살펴보면 -> OS레벨가상화기술은 리눅스커널을 공유 + 소프트웨어 컴포넌트  

Ubuntu호스트에 Windows 컨테이너 동작가능한가?  
 -> 커널이 다르기때문에 동작하지않으며 리눅스환경을 지원하는 이미지가 존재하지않음  

그렇다면 Windows호스트와 MacOs호스트에서 Ubuntu동작이유?  
-> 하이퍼바이저와 관련된 레이어가 추가적으로 구성 + 리눅스킷 이 올라가고 그 위에 도커 엔진이 설치되어 도커는 리눅스환경으로 가능  
but, 가능은 하나 가상화환경에 리눅스킷이 더 구성되기때문에 오버헤드발생하므로 운영환경에서는 지양하자  


### 실습) Alpine리눅스 기본 이미지 만들기  
알파인리눅스: 보안,간편성,리소스 효율을 위해 디자인된 리눅스 배포판 -> 용량 줄이기위한 노력을 하였음  
작은 크기가 중요한 이유? 베이스 이미지를 기반으로 이미지를 만들어서 하나의 이미지가 만들어지는데 사이즈가 작으면 차지하는 메모리공간도 작고 빠르게 로딩할수있기때문에 빠르고 비용효율적으로 어플리케이션을 확장가능하다  
but 많은 라이브러리가 빠져있어서 보통 멀티스테이지빌드를 사용함.  
베이스이미지를 golang이미지에서 코드를 빌드하고 빌드한 바이너리를 알파인 리눅스 기반으로 카피를 해온뒤 스크립트파일을 실행  
(실습환경구성 ch02_4 + ch02_5)  

#### 페도라를 베이스이미지로 사용해보기  
페도라는 yum 명령어로 패키지 관리하므로  
~~~
docker run --rm fedora yum update -y
~~~
디렉토리만들기  
~~~
mkdir base_image && cd base_image
~~~  
베이스이미지 다운후 압축 풀기  
~~~
wget https://github.com/alpinelinux/dodcker-alpine...(생략)  
tar zxf alpine-mini(생략).tar.gz -C alpine_root/  
~~~  
도커이미지를 빌드하기위한 도커파일생성  
~~~
vim Dockerfile
~~~  

도커파일 내용은 다음과 같음  
~~~
FROM fedora
COPY ./alpine_root /
CMD ["/bin/sh"]
~~~  
=> 페도라 배포판에 알파인 리눅스의 루트파일시스템을 덮어씌운 루트위치에 카피  

빌드진행 및 만든 이미지 실행  
~~~
docker build --tag alpine_fedora .
docker run --rm alpine_fedora apk update
~~~  
루트파일시스템을 덮어줬기때문에 yum만되는 기존의 페도라와는 다르게 apk도 실행가능  


### 컨테이너 관련 에코/용어 정리
CNCF : 벤더 중립적 클라우드향 오픈소스 프로젝트를 관리하는 재단  
클라우드 네이티브를 강조하고있음

* 클라우드네이티브?  
-> 퍼블릭/프라이빗/하이브리드 클라우드환경에서 확장가능한 형태로 빠르고 민첩하게 애플리케이션을 빌드하고 실행하는것을 목표로 하는 기술.  
뒷받침하는 기술로 컨테이너, 마이크로서비스, 서비스메시, 변경할수없는 인프라 등이 활용  

#### 런타임과 관련한 컨테이너관련 표준
- OCI  
: 컨테이너 실행에 필요한 저수준 컨테이너 런타임(Cgroups, namespace, security ... 구성)  
: OCI스펙에 따라 컨테이너를 생성 실행하기 위한 대표적 CLI도구-> runc  
- CRI  
: 컨테이너 런타임별 K8s 인터페이스 작성하는 문제 => 하이레벨 컨테이너 런타임 표준 구성

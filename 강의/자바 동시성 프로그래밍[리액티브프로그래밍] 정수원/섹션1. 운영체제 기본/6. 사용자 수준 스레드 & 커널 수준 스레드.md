# 자바 동시성 프로그래밍[리액티브 프로그래밍 파트1]

인프런 정수원님의 자바 동시성 프로그래밍 파트1 강의를 듣고 정리한 내용입니다.



## 1. 운영체제 기본  
- 프로세스 & 스레드  
- Parallel & Concurrent(병렬성과 동시성)  
- 컨텍스트스위치  
- CPU 바운드 / IO 바운드  
- 사용자모드 & 커널모드  
- 사용자 수준 스레드 & 커널 수준 스레드  

### 사용자 수준 스레드 & 커널 수준 스레드  
스레드는 크게 두가지로 구분하는데 사용자 수준 스레드 & 커널 수준 스레드  
사용자 수준 스레드는 사용자 프로그램에서 관리하는 스레드며 커널수준스레드는 OS에서 관리하는 스레드이다  

#### 사용자 수준 스레드
사용자 영역에서 스레드라이브러리(Windowds Threads, JVM 등)에 의해 스레드의 생성과 종료, 스레드간 메시지 전달, 스레드의 스케쥴링 보관 등 모든 것을 관리한다.  
커널은 사용자수준 스레드에 대해 알지못하며 단일 스레드 프로세스인것처럼 관리한다.  

#### 커널 수준 스레드
커널에 스레드와 관련된 모든 작업을 관리한다.(PCB와 TCB고나리/유지)
커널은 커널스레드의 모든 정보를 알고있으며 커널 스레드는 OS스케쥴러에 의해 스케쥴링 된다.  
CPU는 커널에 의해 생성된 커널 스레드의 실행만을 담당한다.  

#### 멀티스레딩 모델  
CPU는 OS스케쥴러가 예약하는 커널스레드만 할당받아 실행하기때문에 사용자수준스레드는 커널수준스레드와 매핑이 필요하다.  
다대일 스레드매핑, 일대일스레드메핑, 다대다 스레드 매핑  
 
#### 다대일 스레드 매핑
다수의 사용자 수준 스레드가 커널수준스레드 한개에 매핑하는 유형으로 사용자 수준의 스레드 모델이라 볼 수 있다.  
(프로세스 하나에 커널스레드 하나)  
- 커널 개입 없이 사용자 스레드 끼리 스위칭이 발생하기때문에 오버헤드가 적다.  
- 스케쥴링이나 동기화를 하려고 커널을 호출하지 않으므로 커널영역으로 전환하는 오버헤드가 줄어든다.  
- 개별 스레드 단위가 아닌 단일 스레드의 프로세스단위로 프로세서를 할당하기때문에 멀티코어를 활용한 병렬처리를 할 수 없다.  
(CPU1:커널스레드1:프로세스1(=사용자스레드n)이므로 남는 CPU사용불가)
- 한 스레드가 Block IO가 발생하면 모든 스레드들이 Block이 발생하는데 이는 프로세스 자체를 블록하기 때문이다.  
- 자바 초기버전 GreenThread가 이 모델에 해당  

#### 일대일 스레드 매핑
사용자 수준 스레드와 커널 수준 스레드가 일대일 수준으로 매핑. 커널수준의 스레드 모델  
- 커널이 전체프로세스와 스레드 정보를 유지해야하기때문에 컨텍스트스위칭시 사용자모드에서 커널모드로 전환해야해서 스케줄링 하는 등의 오버헤드가 발생  
- 자원한정으로 인해 스레드를 무한정으로 생성할수없으므로 스레드 풀을 활용하기도 한다.  
- 스레드 단위로 CPU를 할당하기 때문에 멀티코어를 활용한 병렬처리가 가능하다  
- 스레드 중 한 개가 대기상태가 되더라도 다른 스레드를 실행할 수 있다. 즉 멀티스레드의 동시성을 활용할 수 있다.  
- 자바에서 Native Thread가 이 모델에 해당한다고 볼 수 있다.  

#### 다대다 스레드 매핑  
- 여러개의 사용자 수준 스레드를 같은 수 또는 그보다 작은 수의 커널 수준 스레드로 매핑하는 유형  
- 각 커널 수준의 스레드가 사용자 수순의 스레드 한 개 이상과 매핑된다.  
- 다대다 모델은 다대일,일대일 모델의 단점을 어느정도 해결하여 개발자는 필요한 만큼 많은 사용자 수준 스레드를 생성할 수 있고, 커널 수준 스레드가 멀티프로세서에서 병렬로 수행될 수 있다.  
사용자 수준 스레드가 IO시스템콜을 발생시켰을때 커널이 다른 스레드의 수행을 스케줄 할 수 있다.